{% spaceless %}
	<div id="tl_buttons">
		<a href="{{ referer }}" class="header_back" title="{{ _lang.MSC.backBT }}"
		   accesskey="b">{{ _lang.MSC.backBT }}</a>
	</div>

	<h2 class="sub_headline">{{ _lang.avisota_message_preview.headline }}</h2>

	<div class="tl_listing_container parent_view">
		<div class="tl_header" onmouseover="Theme.hoverDiv(this, 1);" onmouseout="Theme.hoverDiv(this, 0);">
			<div class="tl_content_right">
				<a href="contao/main.php?do=avisota_newsletter&amp;table=orm_avisota_message&amp;act=edit&amp;id={{ message.id }}"
				   accesskey="e" title="{{ _lang.orm_avisota_message.editheader[1]|format(message.id) }}">
					<img src="system/themes/{{ _user.backendTheme ? _user.backendTheme : 'default' }}/images/header.gif"
						 alt="{{ _lang.orm_avisota_message.editheader[0]|format(message.id) }}"/>
				</a>
				<a href="contao/main.php?do=avisota_newsletter&amp;table=orm_avisota_message_content&amp;id={{ message.id }}"
				   accesskey="b" title="{{ _lang.orm_avisota_message.edit[1]|format(message.id) }}">
					<img src="system/themes/{{ _user.backendTheme ? _user.backendTheme : 'default' }}/images/edit.gif"
						 alt="{{ _lang.orm_avisota_message.edit[0]|format(message.id) }}"/>
				</a>

			</div>
			<table class="tl_header_table" summary="" cellpadding="0" cellspacing="0">
				<tbody>
				<tr class="row_0">
					<td class="col_0"><span class="tl_label">{{ _lang.orm_avisota_message.subject[0] }}</span></td>
					<td class="col_1">{{ message.subject }}</td>
				</tr>
				<tr class="row_1">
					<td class="col_0"><span class="tl_label">{{ _lang.orm_avisota_message.recipients[0] }}</span></td>
					<td class="col_1">{{ message.recipients ? message.recipients.title : '-' }}</td>
				</tr>
				<tr class="row_2">
					<td class="col_0"><span class="tl_label">{{ _lang.orm_avisota_message.layout[0] }}</span></td>
					<td class="col_1">{{ message.layout ? message.layout.title : '-' }}</td>
				</tr>
				<tr class="row_3">
					<td class="col_0"><span class="tl_label">{{ _lang.orm_avisota_message.queue[0] }}</span></td>
					<td class="col_1">{{ message.queue ? message.queue.title : '-' }}</td>
				</tr>
				</tbody>
			</table>
		</div>
	</div>

	{{ messages() }}

	{{ modules }}
{% endspaceless %}

<script>
	// add listener to email input field, that disable the user select field
	$('ctrl_recipient_email').addEvent('keyup', function () {
		$('ctrl_recipient_user').disabled = this.value.length > 0;
	});
	// submit listener to form
	$('avisota_message_schedule').addEvent('submit', function () {
		$('avisota_message_schedule').removeEvents('submit').addEvent('submit', function () {
			return false;
		});
	});
	// show the indicator gif of a button
	function indicate(e) {
		e.getElement('img').setStyle('display', '');
	}
	// add listener to preview button
	$('btnPreview').addEvent('click', function () {
		indicate(this);
	});
	{% if _user.isAdmin or _user.hasAccess('send', 'avisota_newsletter_permissions') %}
	// add listener to schedule button
	$('btnSchedule').addEvent('click', function () {
		indicate(this);
	});
	{% endif %}
</script>